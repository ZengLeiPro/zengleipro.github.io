<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>使用Privoxy让Dropbox智能代理上网</title>
  <meta name="description" content="最近身边越来越多人对同步感兴趣，我给他们的建议就是坚持使用Dropbox，不使用国内的类似工具。理由很简单：不安全。不要以为自己是良民就没事，国内的网络环境已经不单是用恶劣可以形容的了，简直到了神经质的状态。">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="使用Privoxy让Dropbox智能代理上网">
  <meta name="twitter:description" content="最近身边越来越多人对同步感兴趣，我给他们的建议就是坚持使用Dropbox，不使用国内的类似工具。理由很简单：不安全。不要以为自己是良民就没事，国内的网络环境已经不单是用恶劣可以形容的了，简直到了神经质的状态。">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="使用Privoxy让Dropbox智能代理上网">
  <meta property="og:description" content="最近身边越来越多人对同步感兴趣，我给他们的建议就是坚持使用Dropbox，不使用国内的类似工具。理由很简单：不安全。不要以为自己是良民就没事，国内的网络环境已经不单是用恶劣可以形容的了，简直到了神经质的状态。">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://zenglei.net/2011/03/dropbox-privoxy/">
  <link rel="alternate" type="application/rss+xml" title="ZengLei" href="http://zenglei.net/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 ZengLei 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="ZengLei logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for ZengLei" class="blog-button">ZengLei</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">The blog of Zeng Lei</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description"></p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
                
                  <li class="navigation__item"><a href="http://project.zenglei.net" target="_blank" title="我的项目">项目</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/zengleipro" title="@zengleipro 的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/zengleipro" title="@zengleipro 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/zengleipro" title="@zengleipro" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  
  <!-- Google Plus -->
  <li class="navigation__item">
    <a href="https://plus.google.com/102218225084839187723" rel="author" title="Google+" target="_blank">
      <i class='social fa fa-google-plus-square'></i>
      <span class="label">Google Plus</span>
    </a>
  </li>
  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:zengleipro@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-green"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2011-03-21 09:29:07 -0500" itemprop="datePublished" class="post-meta__date date">2011-03-21</time> &#8226; <span class="post-meta__tags tags"></span>
    </div>
    <h1 class="post-title">使用Privoxy让Dropbox智能代理上网</h1>
  </header>

  <section class="post">
    <p>最近身边越来越多人对同步感兴趣，我给他们的建议就是坚持使用Dropbox，不使用国内的类似工具。理由很简单：不安全。不要以为自己是良民就没事，国内的网络环境已经不单是用恶劣可以形容的了，简直到了<a href="http://blog.sina.com.cn/s/blog_473d533601017oyy.html" target="_blank">神经质的状态</a>。</p>

<p>既然网络环境这么差，Dropbox当然不能幸免。要用好还是需要花些功夫的，这篇文章介绍的这个技巧我觉得不错，原文在墙外，为了以后给人推荐时省得麻烦，我就直接转过来了。</p>

<p>以下为转载。<a href="http://plusium.blogspot.com/2011/03/privoxydropbox.html" target="_blank">原文地址</a></p>

<p>本文撰于2011/03/20，背景是，中国大陆到dropbox.com的http连接会被重置，但是https连接不受影响。如果背景改变了，则本文失效。本文原始链接：http://plusium.blogspot.com/2011/03/privoxydropbox.html</p>

<p>本文主题：令dropbox客户端的http请求经socks代理访问dropbox服务器，而https请求不经代理直接访问。如图：</p>

<p><img src="http://lh3.ggpht.com/_EBKhIGWdptk/TYWwFpF_R1I/AAAAAAAAACU/xyvWjw2TWtc/1_thumb1.png?imgmax=800" alt="" /></p>

<p>高手们只需看到这就行了。以下是详细操作说明。</p>

<p>目前在墙内，dropbox被关键字屏蔽（Wildcard: .dropbox.com），但是客户端还能正常使用，因为客户端和服务器之间使用的是https加密传输。但只有一处是没有使用https的，就是stork47.dropbox.com（在我这是这个地址，其他地方可能不一样）。这个服务器负责将服务器端（或其他客户端）发生的文件更新通知到其他客户端（我猜的，但应该差不多），然后其他客户端才会发起https请求去和服务器同步这些文件。实际中，是客户端每60秒向stork47.dropbox.com查询一次，看是否有文件需要更新。因为该请求没有使用https连接，导致连接一直被RESET，所以某台客户端的更新无法实时反映到其他客户端。</p>

<p>因为一般人可能没有这个需求，所以没多少人关注这个课题。像我以前也只是在家里和公司同步一些文件而已，没有实时更新的必要。有强烈需求的人，就设置让客户端全程走代理，可以解决上述问题，缺点是文件的更新速度受代理服务器速度的影响，大多数情况下没有直接连接的速度快。还有一部分人当需要更新时，直接重启客户端（甚至为此写了个脚本），因为客户端只在启动时才使用https连接检查更新，这样做的缺点显而易见。</p>

<p>最近用privoxy，发现它可以做到分流http和https，于是试验了一下，果然可以分流dropbox的客户端请求了。就是前面说的，让http请求走代理，而https请求不走。这样即满足了实时更新的需求，又兼顾了更新速度，可谓智能代理了。而且我搜索“dropbox privoxy”，google.com.hk前几页都没有关于这个方法的介绍，所以我这个便算原创了。至于是不是第一个，应该还有高人在，只是我没搜出来而已。因为privoxy还有不少替代方案我没有试过的，比如polipo之类。以下是操作步骤。</p>

<ol>
  <li>
    <p>需要准备的东西：dropbox客户端（还没注册的请点我的邀请链接注册）、代理软件、privoxy。privoxy的官网是http://www.privoxy.org/，不知道下哪一个的话就点这里直接下载win32下的3.0.17稳定版http://sourceforge.net/projects/ijbswa/files/Win32/3.0.17%20(stable)/privoxy-3.0.17.zip/download。该方案应该与平台无关，但是我只在windows 7下试验过。</p>
  </li>
  <li>
    <p>打开privoxy的配置文件config.txt，在最后面添加这几行：</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="k">for </span>dropbox: http --&gt; SOCKS Proxy<span class="o">(</span>19841<span class="o">)</span>, https --&gt; direct
  forward-socks5   .dropbox.com             127.0.0.1:19841 .
  forward          .dropbox.com:443         .
</code></pre>
</div>

<p>注意将19841修改为你自己的代理软件的端口。如果你的代理软件不是socks类型的，那么就不是加上面的几行，而是加这几行：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="k">for </span>dropbox: http --&gt; HTTP Proxy<span class="o">(</span>19842<span class="o">)</span>, https --&gt; direct
  forward          .dropbox.com             127.0.0.1:19842
  forward          .dropbox.com:443         .
</code></pre>
</div>

<p>注意好多地方有半角的.号，不要弄丢了。</p>

<ol>
  <li>启动privoxy，将dropbox的代理设置为HTTP 127.0.0.1:8118，就OK了。</li>
</ol>

<p>如果有疑问可以留言讨论，如果有关于软件的其他用法的问题请另行google。</p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title">
           <a href="/2011/04/rio/" title="link to RIO观后感">RIO观后感</a>
        </h2>
       <p class="excerpt">Kelven说我很久没更新了。所以顺手写一篇吧。看了韩寒的推荐，中午和老婆去看了《RIO》（里...&hellip;</p>
       <div class="post-list__meta"><time datetime="2011-04-23 06:09:04 -0500" class="post-list__meta--date date">2011-04-23</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2011/04/rio/>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2011/03/thoughts-of-japan-earthquake/" title="link to 关于日本这次地震的感想">关于日本这次地震的感想</a></h2>
       <p class="excerpt">日本当地时间11日下午2点46分，位于日本东北地区的三陆海域发生8.4级强烈地震。这次地震是日...&hellip;</p>
       <div class="post-list__meta"><time datetime="2011-03-12 00:01:01 -0600" class="post-list__meta--date date">2011-03-12</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2011/03/thoughts-of-japan-earthquake/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>
    
    var disqus_config = function () {
        this.page.url = "http://zenglei.net/2011/03/dropbox-privoxy/";
        this.page.identifier = "/2011/03/dropbox-privoxy/";
    };

    var disqus_shortname = 'ZengLeiPro';
    
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>要查看<a href="http://disqus.com/?ref_noscript"> Disqus </a>评论，请启用 JavaScript</noscript>
    
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">由 <a href="https://jekyllrb.com">Jekyll</a> 于 2017-07-03 生成，由 <a href="https://www.aliyun.com/">阿里云</a> 为本站提供稳定的 VPS 服务</span>
        <span class="footer__copyright">本站采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/onevcat/OneV-s-Den">本站源码</a> - &copy; 2017</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73009334-1', 'auto');
  ga('send', 'pageview');
</script>

    
  </body>

</html>
